<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Розклад</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">

</head>
<body>

    <h2>Розклад на {{ date or 'всі дати' }}</h2>
    </div>
        <!-- Кнопка для відкриття модального вікна -->
<button onclick="openLoginModal()">Увійти</button>

<!-- Модальне вікно -->
<div id="loginModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeLoginModal()">&times;</span>
        <h2>Вхід в адмін-панель</h2>
        <form id="loginForm">
            <label for="username">Логін:</label>
            <input type="text" id="username" name="username" required>

            <label for="password">Пароль:</label>
            <input type="password" id="password" name="password" required>

            <button type="submit">Увійти</button>
        </form>
        <p id="loginError" style="color: red; display: none;">Неправильний логін або пароль</p>
    </div>
</div>

<!-- Стилі для модального вікна -->
<style>
    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
    }
    .modal-content {
        background-color: white;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 300px;
        text-align: center;
    }
    .close {
        color: black;
        float: right;
        font-size: 24px;
        cursor: pointer;
    }
</style>

<!-- Скрипт для модального вікна -->
<script>
    function openLoginModal() {
        document.getElementById('loginModal').style.display = 'block';
    }

    function closeLoginModal() {
        document.getElementById('loginModal').style.display = 'none';
    }

    document.getElementById('loginForm').onsubmit = function(event) {
        event.preventDefault(); // Запобігаємо перезавантаженню

        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        fetch('/admin/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `username=${username}&password=${password}`
        })
        .then(response => response.text())
        .then(data => {
            if (data.includes("Неправильний логін або пароль")) {
                document.getElementById('loginError').style.display = 'block';
            } else {
                window.location.href = '/admin/dashboard'; // Якщо успішно, переходимо в адмінку
            }
        });
    };
</script>
    <form method="GET" action="/">
        <label for="date">Дата:</label>
        <input type="date" id="date" name="date" value="{{ date or '' }}">
        
        <label for="group">Група:</label>
            <select id="group" name="group">
                {% for group_id, group_name in groups %}
                    <option value="{{ group_id }}" {% if group == group_id %}selected{% endif %}>{{ group_name }}</option>
                {% endfor %}
            </select>

        <label for="teacher">Викладач:</label>
        <input type="text" id="teacher" name="teacher" value="{{ teacher or '' }}" placeholder="Введіть ім'я викладача">
        
        <button type="submit">Фільтрувати</button>
    </form>
    
    <table border="1">
        <tr>
            <th>Група</th>
            <th>Пара</th>
            <th>Предмет</th>
            <th>Викладач</th>
        </tr>
        {% for row in schedule %}
        <tr>
            <td>{{ row[0] }}</td>
            <td>{{ row[3] }}</td>
            <td>{{ row[1] }}</td>
            <td>{{ row[2] }}</td>
        </tr>
        {% endfor %}
    </table>


</body>
</html>
